<!DOCTYPE html>
<html>
<head>
	<title>Test</title>
	<script type="text/javascript" src="../lib/noders-gl.js"></script>
	<script type="text/javascript" src="../lib/gl-matrix-min.js"></script>
	<script type="text/javascript" src="../lib/orbital-camera.js"></script>
</head>
<body>
<canvas id="canvas" width="512" height="512"></canvas>
<script type="text/javascript">
	const renderer = new NGL.Renderer({ canvas: document.getElementById('canvas') });
	const simplePipeline = new NGL.Pipeline({
		renderer: renderer,
		vertexSize: Float32Array.BYTES_PER_ELEMENT * 5,
		vertShader: 
		`
		precision mediump float;

		uniform float uTime;
		uniform mat4 uView;
		uniform mat4 uProjection;

		attribute vec2 inPosition;
		attribute vec2 inTexCoord;

		varying vec2 outTexCoord;

		void main() {
			gl_Position = uProjection * uView * vec4(inPosition, 0.0, 1.0);

			outTexCoord = inTexCoord;
		}

		`,
		fragShader:
		`
		precision mediump float;

		uniform float uTime;
		uniform sampler2D uMainSampler;

		varying vec2 outTexCoord;

		void main () { gl_FragColor = texture2D(uMainSampler, outTexCoord); }
		`,
		attributes:  {
			'inPosition': {
				size: 3,
				type: NGL.AttribType.FLOAT,
				offset: 0
			},
			'inTexCoord': {
				size: 2,
				type: NGL.AttribType.FLOAT,
				offset: Float32Array.BYTES_PER_ELEMENT * 3
			}
		}
	});
	const vertexBuffer = new NGL.VertexBuffer({
		renderer: renderer,
		data: new Float32Array([
			-0.5, +0.5, +0.0, +0.0, +0.0,
			-0.5, -0.5, +0.0, +0.0, +1.0,
			+0.5, -0.5, +0.0, +1.0, +1.0,
			-0.5, +0.5, +0.0, +0.0, +0.0,
			+0.5, -0.5, +0.0, +1.0, +1.0,
			+0.5, +0.5, +0.0, +1.0, +0.0
		])
	});
	const testTexture = new NGL.Texture2D({
		renderer: renderer,
		source: new Uint8Array([
			0xff, 0x00, 0x00, 0xff,
			0x00, 0xff, 0x00, 0xff,
			0x00, 0x00, 0xff, 0xff,
			0xff, 0xff, 0x00, 0xff
		]),
		width: 2,
		height: 2,
		filter: NGL.TextureFilter.LINEAR
	});
	const testTextureRed = new NGL.Texture2D({
		renderer: renderer,
		source: new Uint8Array([
			0xff, 0x00, 0x00, 0xff,
			0xff, 0x00, 0x00, 0xff,
			0xff, 0x00, 0x00, 0xff,
			0xff, 0x00, 0x00, 0xff
		]),
		width: 2,
		height: 2,
		filter: NGL.TextureFilter.NEAREST
	});
	let time = 0.0;
	const projection = mat4.create();
	const view = mat4.create();
	const camera = new OrbitalCameraControl(view);

	mat4.perspective(projection, Math.PI / 8, renderer.getAspectRatio(), 0.01, 1000.0);

	simplePipeline.setUniform('uProjection', NGL.UniformType.MATRIX_4, false, projection);
	simplePipeline.setUniform('uView', NGL.UniformType.MATRIX_4, false, view);

	requestAnimationFrame(function loop() {
		renderer.beginPass(vertexBuffer, simplePipeline);
		{
			renderer.clearTarget(NGL.ClearTarget.ALL);

			time += 0.01;
			simplePipeline.setUniform('uTime', NGL.UniformType.FLOAT_1, time)
			simplePipeline.setUniform('uView', NGL.UniformType.MATRIX_4, false, view);
			renderer.setTexture2D(testTexture);
			renderer.draw(0, 6);

			mat4.rotateY(view, 0.01);

		}
		renderer.endPass();

		camera.update();
		requestAnimationFrame(loop);
	});
</script>
</body>
</html>